# Packages ----
require(rstudioapi)
# Load data ----
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
list.files(getwd())
list.files(paste0(c(getwd(), "Data"), collapse = filesep))
filesep
pathsep
list.files(paste0(c(getwd(), "Data"), collapse = "\"))
list.files(paste0(c(getwd(), "Data"), collapse = "\\"))
list.files(paste0(c(getwd(), "Data"), collapse = "\\"))
getwd()
list.files(paste0(c(getwd(), "Data", "Castor Data"), collapse = "\\"))
files = list.files(paste0(c(getwd(), "Data", "Castor Data"), collapse = "\\"))
require(stringr)
grepl("TAPQOL", files)
find(grepl("TAPQOL", files))
?which
which(grepl("TAPQOL", files))
rep(0, 10)
survey_files = list(survey = c("TRACK", "ISAAC", "TAPQOL", "EQ-5D-Y", "EQ-5D-5L", "HCSRU"),
file = rep(0, 6))
length(survey_files$survey)
survey_files$survey
for (i in 1:length(survey_files$survey)){
survey_files$file[i] = which(grepl(survey_files$survey[i], files))
}
survey_folder = paste0(c(getwd(), "Data", "Castor Data")
files = list.files(, collapse = "\\"))
survey_folder = paste0(c(getwd(), "Data", "Castor Data"), collapse = "\\")
survey_folder
files = list.files(survey_folder)
survey_folder = paste0(c(getwd(), "Data", "Castor Data"), collapse = "/")
files = list.files(survey_folder)
files
?list
list(survey_files$survey)
surveys = list()
survey[1] = 3
surveys[1] = 3
surveys[2] = 3
View(surveys)
i = 1
surveys = list()
surveys[i] = read.csv(survey_files$file[i], sep = ";")
survey_files$file
rep("", 6)
grepl(survey_files$survey[i], files)
files[grepl(survey_files$survey[i], files)]
survey_files = list(survey = c("TRACK", "ISAAC", "TAPQOL", "EQ-5D-Y", "EQ-5D-5L", "HCSRU"),
file = rep("", 6),
id = rep(0, 6))
# surveys[i] = read.csv(files[i], sep = ";")
}
for (i in 1:length(survey_files$survey)){
survey_files$file[i] = files[grepl(survey_files$survey[i], files)]
survey_files$id[i] = which(grepl(survey_files$survey[i], files))
# surveys[i] = read.csv(files[i], sep = ";")
}
survey_files = list(survey = c("TRACK", "ISAAC", "TAPQOL", "EQ-5D-Y", "EQ-5D-5L", "HCSRU"),
file = rep("", 6),
id = rep(0, 6))
for (i in 1:length(survey_files$survey)){
survey_files$file[i] = files[grepl(survey_files$survey[i], files)]
survey_files$id[i] = which(grepl(survey_files$survey[i], files))
# surveys[i] = read.csv(files[i], sep = ";")
}
survey_files$file[i]
files[grepl(survey_files$survey[i], files)]
?grepl
grepl(survey_files$survey[i], files)[1]
grep(survey_files$survey[i], files)
grep(survey_files$survey[i], files)
match(grepl(survey_files$survey[i], files))
match("T", grepl(survey_files$survey[i], files))
match(T, grepl(survey_files$survey[i], files))
files[match(T, grepl(survey_files$survey[i], files))]
for (i in 1:length(survey_files$survey)){
survey_files$file[i] = files[match(T, grepl(survey_files$survey[i], files))]
survey_files$id[i] = match(T, grepl(survey_files$survey[i], files))
# surveys[i] = read.csv(files[i], sep = ";")
}
i = 1
surveys[i] = read.csv(survey_files$file[i], sep = ";")
paste0(c(survey_folder, survey_files$file[i]), collapse = "/")
surveys[i] = read.csv(paste0(c(survey_folder, survey_files$file[i]), collapse = "/"), sep = ";")
View(surveys)
View(surveys[[1]])
surveys = list()
surveys[[i]] = read.csv(paste0(c(survey_folder, survey_files$file[i]), collapse = "/"), sep = ";")
View(surveys[[1]])
surveys = list()
survey_files = list(survey = c("TRACK", "ISAAC", "TAPQOL", "EQ-5D-Y", "EQ-5D-5L", "HCSRU"),
file = rep("", 6),
id = rep(0, 6))
for (i in 1:length(survey_files$survey)){
survey_files$file[i] = files[match(T, grepl(survey_files$survey[i], files))]
survey_files$id[i] = match(T, grepl(survey_files$survey[i], files))
surveys[[i]] = read.csv(paste0(c(survey_folder, survey_files$file[i]), collapse = "/"), sep = ";")
}
names(surveys) = survey_files$survey
View(surveys[["TRACK"]])
source("~/Work/ADEM2/Data analysis/dataReformatting.R", echo=TRUE)
View(surveys)
View(surveys[["TRACK"]])
study_variablelist = read.csv(paste0(c(survey_folder, "study_variablelist.csv"), collapse = "/"), sep = ";")
View(study_variablelist)
study_variablelist$Form.number
View(surveys)
colnames(surveys$TRACK)
surveys$TRACK["TRACK1":"TRACK5"]
surveys$TRACK %>% select(TRACK1:TRACK5)
require(dplyr)
surveys$TRACK %>% select(TRACK1:TRACK5)
?select
surveys$TRACK %>% select(c(Castor.Participant.ID, TRACK1:TRACK5))
sum_track = surveys$TRACK %>% select(c(Castor.Participant.ID, TRACK1:TRACK5))
sum(sum_track[,2:6])
?rowwise
?sum
rowSums(sum_track[,2:6])
sum_track$TRACKSUM = rowSums(sum_track[,2:6])
View(sum_track)
# Cleaning each survey ----
## Cleaning TRACK Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$TRACK %>% select(!contains(rm_col))
test = surveys$TRACK %>% select(!contains(rm_col))
View(test)
surveys$TRACK = surveys$TRACK %>% select(!contains(rm_col))
View(surveys[["TRACK"]])
rowSums(surveys$TRACK %>% select(c(TRACK1:TRACK5)))
sum_track = rowSums(surveys$TRACK %>% select(c(TRACK1:TRACK5)))
surveys$TRACK$TRACKSUM = rowSums(sum_track[,2:6])
View(surveys[["TRACK"]])
rowSums(surveys$TRACK %>% select(c(TRACK1:TRACK5)))
surveys$TRACK$TRACKSUM = rowSums(surveys$TRACK %>% select(c(TRACK1:TRACK5)))
View(surveys[["TRACK"]])
rm(rm_col)
rm(i)
rm(sum_track)
rm(test)
View(surveys[["ISAAC"]])
## Cleaning ISAAC Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$ISAAC = surveys$ISAAC %>% select(!contains(rm_col))
rm(rm_col)
View(surveys[["TAPQOL"]])
?grep()
gsub("-", "_", survey_files$survey)
names(surveys) = gsub("-", "_", survey_files$survey)
View(surveys[["EQ_5D_Y"]])
## Cleaning ISAAC Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$ISAAC = surveys$ISAAC %>% select(!contains(rm_col))
rm(rm_col)
## Cleaning TAPQOL Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$TAPQOL = surveys$TAPQOL %>% select(!contains(rm_col))
rm(rm_col)
## Cleaning EQ-5D-Y Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$EQ_5D_Y = surveys$EQ_5D_Y %>% select(!contains(rm_col))
rm(rm_col)
## Cleaning EQ-5D-5L Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$EQ_5D_5L = surveys$EQ_5D_5L %>% select(!contains(rm_col))
rm(rm_col)
## Cleaning HCSRU Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$HCSRU = surveys$HCSRU %>% select(!contains(rm_col))
rm(rm_col)
View(surveys)
require(rstudioapi)
require(stringr)
require(dplyr)
# Load data ----
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
survey_folder = paste0(c(getwd(), "Data", "Castor Data"), collapse = "/")
files = list.files(survey_folder)
survey_files = list(survey = c("TRACK", "ISAAC", "TAPQOL", "EQ-5D-Y", "EQ-5D-5L", "HCSRU"),
file = rep("", 6),
id = rep(0, 6))
surveys = list()
for (i in 1:length(survey_files$survey)){
survey_files$file[i] = files[match(T, grepl(survey_files$survey[i], files))]
survey_files$id[i] = match(T, grepl(survey_files$survey[i], files))
surveys[[i]] = read.csv(paste0(c(survey_folder, survey_files$file[i]), collapse = "/"), sep = ";")
}
names(surveys) = gsub("-", "_", survey_files$survey)
study_variablelist = read.csv(paste0(c(survey_folder, "study_variablelist.csv"), collapse = "/"), sep = ";")
rm(i)
View(surveys)
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$TRACK = surveys$TRACK %>% select(!contains(rm_col))
surveys$TRACK$TRACKSUM = rowSums(surveys$TRACK %>% select(c(TRACK1:TRACK5)))
rm(rm_col)
## Cleaning ISAAC Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$ISAAC = surveys$ISAAC %>% select(!contains(rm_col))
rm(rm_col)
## Cleaning TAPQOL Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$TAPQOL = surveys$TAPQOL %>% select(!contains(rm_col))
rm(rm_col)
## Cleaning EQ-5D-Y Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$EQ_5D_Y = surveys$EQ_5D_Y %>% select(!contains(rm_col))
rm(rm_col)
## Cleaning EQ-5D-5L Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$EQ_5D_5L = surveys$EQ_5D_5L %>% select(!contains(rm_col))
rm(rm_col)
## Cleaning HCSRU Survey ----
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys$HCSRU = surveys$HCSRU %>% select(!contains(rm_col))
rm(rm_col)
View(surveys[["TRACK"]])
class(surveys$TRACK$Survey.Creation.Date)
testdate = as.Date(surveys$TRACK$Survey.Creation.Date)
?as.Date
testdate
testdate = as.Date(surveys$TRACK$Survey.Creation.Date, format = "%d-%m-%y %h:%m:%s")
testdate
testdate = as.Date(surveys$TRACK$Survey.Creation.Date, format = "%d-%m-%y")
testdate
# Reformat dates
surveys$TRACK %>% as.Date(Survey.Creation.Date, format = "%d-%m-%y")
# Reformat dates
surveys$TRACK$Survey.Creation.Date %>% as.Date(format = "%d-%m-%y")
# Reformat dates
as.Date(surveys$TRACK[c("Survey.Creation.Date")], format = "%d-%m-%y")
surveys$TRACK[c("Survey.Creation.Date")]
surveys$TRACK["Survey.Creation.Date"]
# Reformat dates
as.Date(surveys$TRACK["Survey.Creation.Date"], format = "%d-%m-%y")
i = 1
as.Date(surveys$TRACK[datecols[i]], format = "%d-%m-%y")
# Reformat dates
datecols = c("Survey.Creation.Date", "Survey.Sent.Date", "Survey.Completed.On")
as.Date(surveys$TRACK[datecols[i]], format = "%d-%m-%y")
as.Date(surveys$TRACK[[datecols[i]]], format = "%d-%m-%y")
as.Date(surveys$TRACK[[datecols]], format = "%d-%m-%y")
as.Date(surveys$TRACK[datecols], format = "%d-%m-%y")
surveys$TRACK[[datecols[i]]] = as.Date(surveys$TRACK[[datecols[i]]], format = "%d-%m-%y")
View(surveys[["TRACK"]])
class(surveys$TRACK$Survey.Creation.Date)
for (i in 1:length(datecols)){
surveys$TRACK[[datecols[i]]] = as.Date(surveys$TRACK[[datecols[i]]], format = "%d-%m-%y")
}
View(surveys[["TRACK"]])
View(surveys[["ISAAC"]])
surveys[1][[datecols[1]]]
surveys[[1]][[datecols[1]]]
surveys[[2]][[datecols[1]]]
surveys[[2]][[datecols[1]]] = as.Date(surveys[[2]][[datecols[1]]], format = "%d-%m-%y")
View(surveys[["ISAAC"]])
length(surveys)
require(rstudioapi)
require(stringr)
require(dplyr)
# Load data ----
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
survey_folder = paste0(c(getwd(), "Data", "Castor Data"), collapse = "/")
files = list.files(survey_folder)
survey_files = list(survey = c("TRACK", "ISAAC", "TAPQOL", "EQ-5D-Y", "EQ-5D-5L", "HCSRU"),
file = rep("", 6),
id = rep(0, 6))
surveys = list()
for (i in 1:length(survey_files$survey)){
survey_files$file[i] = files[match(T, grepl(survey_files$survey[i], files))]
survey_files$id[i] = match(T, grepl(survey_files$survey[i], files))
surveys[[i]] = read.csv(paste0(c(survey_folder, survey_files$file[i]), collapse = "/"), sep = ";")
}
names(surveys) = gsub("-", "_", survey_files$survey)
study_variablelist = read.csv(paste0(c(survey_folder, "study_variablelist.csv"), collapse = "/"), sep = ";")
rm(i)
# Cleaning each survey ----
# Common cleaning ----
for (i in 1:length(surveys)){
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys[[i]] = surveys[[i]] %>% select(!contains(rm_col))
datecols = c("Survey.Creation.Date", "Survey.Sent.Date", "Survey.Completed.On")
for (j in 1:length(datecols)){
surveys[[i]][[datecols[j]]] = as.Date(surveys$TRACK[[datecols[j]]], format = "%d-%m-%y")
}
}
View(surveys)
View(surveys[["TRACK"]])
View(surveys[["TRACK"]])
# Cleaning each survey ----
# Common cleaning ----
for (i in 1:length(surveys)){
rm_col = c("Survey.Instance.Id", "Survey.Package.Id")
surveys[[i]] = surveys[[i]] %>% select(!contains(rm_col))
datecols = c("Survey.Creation.Date", "Survey.Sent.Date", "Survey.Completed.On")
for (j in 1:length(datecols)){
surveys[[i]][[datecols[j]]] = as.Date(surveys[[i]][[datecols[j]]], format = "%d-%m-%y")
}
}
View(surveys[["ISAAC"]])
?seq
